<div class="container">
    <h1>{{ recipe.name }}</h1>
    <div class="rating-container">
      <div class="stars" (mouseleave)="onRatingLeave()">
        <div
          class="star"
          *ngFor="let star of [1,2,3,4,5]; let i = index"
          [class.filled]="currentRating >= (i * 2 + 2)"
          [class.half-filled]="currentRating === (i * 2 + 1)"
          (mousemove)="onStarHover($event, i)"
          (click)="onStarClick($event, i)"
        >
          ‚òÖ
        </div>
      </div>
      <div
        class="rating-preview"
        [class.visible]="showPreview"
        [style.left.px]="previewPosition"
      >
        {{ previewRating.toFixed(1) }} –∏–∑ 10
      </div>
      <div class="average-rating" *ngIf="recipe?.avgRating != null">
        –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: {{ recipe.avgRating.toFixed(1) }} –∏–∑ 10
      </div>
    </div>
    
    <div class="recipe-description">
      <p>{{ recipe.description }}</p>
    </div>
  
    <h2>–§–æ—Ç–æ –±–ª—é–¥–∞:</h2>
      <div class="photos">
          <ng-container *ngIf="getPhotoFood() as photoName; else defaultPhoto">
            <img
              [src]="getPhotoUrl(photoName)"
              alt="–§–æ—Ç–æ –±–ª—é–¥–∞"
              class="recipe-image"
            >
      </ng-container>
      <ng-template #defaultPhoto>
        <img
          src="/static/images/default-recipe.png"
          alt="–ù–µ—Ç —Ñ–æ—Ç–æ"
          class="recipe-image"
        >
      </ng-template>
    </div>
  
    <h2>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h2>
    <div class="ingredients">
      <ng-container *ngIf="recipe.ingredients?.length > 0; else noIngredients">
        <div *ngFor="let ingredient of recipe.ingredients">
          <p>
            <strong>{{ ingredient.name }}</strong>: {{ ingredient.count }} {{ingredient.unit}}
          </p>
        </div>
      </ng-container>
      <ng-template #noIngredients>
        <p>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
      </ng-template>
    </div>
  
    <h2>–®–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h2>
    <div class="steps">
      <ng-container *ngIf="recipe.steps?.length > 0; else noSteps">
        <div *ngFor="let step of recipe.steps">
          <h3>–®–∞–≥ {{ step.stepNumber }}</h3>
          <p>{{ step.description }}</p>
          <img
            *ngIf="step.photo"
            [src]="getPhotoUrl(step.photo.name)"
            alt="–§–æ—Ç–æ —à–∞–≥–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è"
          />
        </div>
      </ng-container>
      <ng-template #noSteps>
        <p>–®–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
      </ng-template>
    </div>
  
    <div class="details">
      <p><strong>–¢–µ–º–∞ –±–ª—é–¥–∞:</strong> {{ recipe.theme }}</p>
      <p><strong>–¢–∏–ø –±–ª—é–¥–∞:</strong> {{ recipe.typeOfFood }}</p>
      <p><strong>–¢–∏–ø –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> {{ recipe.typeOfCook }}</p>
      <p><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong> {{ recipe.restrictions }}</p>
      <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π:</strong> {{ recipe.countPortion }}</p>
      <p><strong>–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å (–∫–∫–∞–ª):</strong> {{ recipe.kkal }}</p>
      <p><strong>–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> {{ recipe.timeToCook }} –º–∏–Ω—É—Ç</p>
    </div>
  
    <p><strong>–ê–≤—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–∞:</strong> {{ recipe.authorUsername }}</p>
    <div class="update-recipe-container">
      <h1>–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</h1>
      <form (ngSubmit)="onUpdateRecipe()">
        <div *ngIf="isAdmin || isOwner">
          <button type="button" class="delete-button" (click)="onDeleteRecipe()">
            –£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç
          </button>
          <button type="submit" class="button">
            –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç
          </button>
        </div>
        <div *ngIf="errorMessage" style="color: red; font-weight: bold; margin-bottom: 20px;">
          <p>{{ errorMessage }}</p>
        </div>
      </form>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h2>
    <div class="comment-form">
      <input 
        [(ngModel)]="newComment" 
        placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." 
        class="comment-input"
      />
      <button class="button" (click)="addComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <div class="comments-section">
      <ng-container *ngIf="comments !== undefined && comments.length > 0; else noComments">
        <div *ngFor="let comment of comments; let ci = index" class="comment">
          <div class="comment-header">
            <strong>{{ comment.author || '–í—ã' }}</strong>
            <ng-container *ngIf="currentUsername === comment.author || isAdmin">
              <button class="menu-button" (click)="toggleCommentMenu(ci, $event)">‚ãØ</button>
              <div class="comment-menu" *ngIf="openedMenuIndex === ci">
                <button (click)="startEditComment(comment)">–û–±–Ω–æ–≤–∏—Ç—å</button>
                <button (click)="deleteComment(comment.id)">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </ng-container>
          </div>
          <div class="comment-content">
            <ng-container *ngIf="editingCommentId === comment.id; else showCommentContent">
              <input [(ngModel)]="editingCommentContent" class="comment-edit-input" />
              <button (click)="updateComment(comment.id)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button (click)="cancelEditComment()">–û—Ç–º–µ–Ω–∞</button>
            </ng-container>
            <ng-template #showCommentContent>
              <p>{{ comment.content }}</p>
            </ng-template>
          </div>
          <div class="comment-actions">
            <span class="likes" 
              [class.active]="comment.reaction === 'liked'"
              (click)="likeComment(comment.id)">
              <span class="like-count">{{ comment.likes || 0 }}</span> üëç
            </span>
            <span class="dislikes" 
              [class.active]="comment.reaction === 'disliked'"
              (click)="dislikeComment(comment.id)">
              <span class="dislike-count">{{ comment.dislikes || 0 }}</span> üëé
            </span>
          </div>          
        </div>
      </ng-container>
      <ng-template #noComments>
        <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
      </ng-template>
    </div>
    <a (click)="goBack()" class="back-link">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ä–µ—Ü–µ–ø—Ç–æ–≤</a>
  </div>
  